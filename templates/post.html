<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{.Post.Title}} • Polar Lights Forum 2026</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" type="image/png" href="/static/images/favicon.png">
    <script>
        window.userRole = "{{.Role}}";
    </script>
    <script src="/static/script.js" defer></script>
</head>
<body class="aurora-body">
    <div class="site-container">
        <header class="aurora-header compact">
            <div class="header-container">
                <div class="header-top">
                    <a href="/" class="logo">
                        <img src="/static/images/logo.png" alt="Polar Lights Forum 2026">
                        <div class="logo-text">
                            <span>Polar Lights</span>
                            <small>New Year 2026</small>
                        </div>
                    </a>
                    <div class="categories">
                        <a href="/?category=news" class="category-btn">Polar News</a>
                        <a href="/?category=life" class="category-btn">Traditions & Hearth</a>
                        <a href="/?category=auto" class="category-btn">Winter Travel</a>
                        <a href="/?category=creative" class="category-btn">DIY Décor</a>
                        <a href="/?category=gadgets" class="category-btn">Gift Gadgets</a>
                        <a href="/?category=science" class="category-btn">Snow Science</a>
                        <a href="/?category=games" class="category-btn">Party Games</a>
                        <a href="/?category=other" class="category-btn">Wish Wall</a>
                    </div>
                    <div class="countdown-panel">
                        <p>до Нового года</p>
                        <div id="countdown-timer" class="countdown-timer">00d • 00h • 00m • 00s</div>
                    </div>
                </div>
            </div>
        </header>
        <div class="filters">
            <a href="/?filter=new" class="{{if eq .Filter "new"}}active{{end}}">Fresh Sparks</a>
            <a href="/?filter=best" class="{{if eq .Filter "best"}}active{{end}}">Firework Hits</a>
            {{if .IsAuthenticated}}
                <a href="/?filter=my" class="{{if eq .Filter "my"}}active{{end}}">My Rituals</a>
                <a href="/?filter=liked" class="{{if eq .Filter "liked"}}active{{end}}">Sparkles I Loved</a>
                <a href="/?filter=commented" class="{{if eq .Filter "commented"}}active{{end}}">Chats I Warmed</a>
            {{end}}
        </div>
        <main>
            <div class="main-container">
                <section class="left-column">
                    <article class="post-card" id="post-{{.Post.ID}}">
                        <div class="post-header">
                            {{if .Post.ImageURL}}
                                <img src="{{.Post.ImageURL}}" alt="Post image" class="post-image">
                            {{end}}
                            <div class="post-info">
                                <div class="post-badge">
                                    ✨
                                    {{if eq .Post.Category "news"}}Polar News{{else if eq .Post.Category "life"}}Traditions & Hearth{{else if eq .Post.Category "auto"}}Winter Travel{{else if eq .Post.Category "creative"}}DIY Décor{{else if eq .Post.Category "gadgets"}}Gift Gadgets{{else if eq .Post.Category "science"}}Snow Science{{else if eq .Post.Category "games"}}Party Games{{else}}Wish Wall{{end}}
                                </div>
                                <h3>{{.Post.Title}}</h3>
                                <div class="post-meta">
                                    <span>{{.Post.CreatedAtStr}}</span>
                                    <span>by <a href="/profile?user_id={{.Post.UserID}}">{{.Post.Username}}</a></span>
                                </div>
                                <div class="post-metrics">
                                    <span id="likes-{{.Post.ID}}">❤️ {{.Post.Likes}}</span>
                                    <span id="dislikes-{{.Post.ID}}">❄️ {{.Post.Dislikes}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>{{.Post.Content}}</p>
                        </div>
                        {{if .IsAuthenticated}}
                            <div id="votes-{{.Post.ID}}" class="vote-buttons">
                                <button onclick="vote('{{.Post.ID}}', 'like')" class="vote-btn {{if eq .Post.UserVote 1}}liked{{end}}" data-action="like">Поддержать</button>
                                <button onclick="vote('{{.Post.ID}}', 'dislike')" class="vote-btn {{if eq .Post.UserVote -1}}disliked{{end}}" data-action="dislike">Охладить</button>
                                {{if or (eq .UserID .Post.UserID) (eq .Role "admin")}}
                                    {{if eq .UserID .Post.UserID}}
                                        <a href="/edit-post?post_id={{.Post.ID}}" class="edit-btn">Редактировать</a>
                                    {{end}}
                                    <button onclick="deletePost('{{.Post.ID}}')" class="delete-btn">Удалить</button>
                                {{end}}
                            </div>
                            <form id="comment-form-{{.Post.ID}}" onsubmit="addComment(event, '{{.Post.ID}}')">
                                <input type="hidden" name="post_id" value="{{.Post.ID}}">
                                <textarea name="content" placeholder="Добавить искру в разговор" required></textarea>
                                <div class="error-message" id="error-{{.Post.ID}}" style="color: var(--danger); display: none;"></div>
                                <button type="submit">Оставить комментарий</button>
                            </form>
                        {{end}}
                        <h4>Комментарии</h4>
                        <div id="comments-{{.Post.ID}}">
                            {{range .Post.Comments}}
                                <div class="comment" id="comment-{{.ID}}">
                                    <p id="comment-content-{{.ID}}">{{.Content}} — <a href="/profile?user_id={{.UserID}}">{{.Username}}</a> ({{.CreatedAtStr}})</p>
                                    <p id="comment-likes-{{.ID}}">Likes: {{.Likes}}</p>
                                    <p id="comment-dislikes-{{.ID}}">Dislikes: {{.Dislikes}}</p>
                                    {{if $.IsAuthenticated}}
                                        <div class="comment-actions">
                                            <button onclick="voteComment('{{.ID}}', 'comment-like')" class="vote-btn {{if eq .UserVote 1}}liked{{end}}" data-action="comment-like">Поддержать</button>
                                            <button onclick="voteComment('{{.ID}}', 'comment-dislike')" class="vote-btn {{if eq .UserVote -1}}disliked{{end}}" data-action="comment-dislike">Охладить</button>
                                            {{if or (eq $.UserID .UserID) (eq $.Role "admin")}}
                                                <button onclick="deleteComment('{{.ID}}')" class="delete-btn">Удалить</button>
                                            {{end}}
                                        </div>
                                    {{else}}
                                        <span>Войдите, чтобы голосовать</span>
                                    {{end}}
                                </div>
                            {{end}}
                        </div>
                    </article>
                </section>
                <section class="right-column">
                    {{if not .IsAuthenticated}}
                        <div class="login-box">
                            <h3>Войти в Polar Lights</h3>
                            {{if .ErrorMessage}}
                                <p class="message">{{.ErrorMessage}}</p>
                            {{end}}
                            {{if .Message}}
                                <div class="message">{{.Message}}</div>
                            {{end}}
                            <form method="POST" action="/login">
                                <input type="email" name="email" placeholder="Email" required>
                                <input type="password" name="password" placeholder="Password" required>
                                <div class="button-group">
                                    <button type="submit">Войти</button>
                                    <a href="/register" class="register-btn">Регистрация</a>
                                </div>
                            </form>
                        </div>
                    {{else}}
                        <div class="user-box">
                            <p>С наступающим, {{.Username}}!</p>
                            <a href="/create-post">Создать огонёк</a>
                            <a href="/profile?user_id={{.UserID}}">Профиль</a>
                            <a href="/logout">Выход</a>
                        </div>
                    {{end}}
                    <div class="countdown-card">
                        <h3>Community Countdown</h3>
                        <p>Новый год совсем рядом:</p>
                        <strong id="mini-countdown">00d • 00h • 00m • 00s</strong>
                    </div>
                    <div class="ad-box">
                        <img src="/static/images/lanterns.png" alt="Wish Wall illustration" class="ad-image">
                        <p>Каждый комментарий — снежинка в общем сне.</p>
                    </div>
                </section>
            </div>
        </main>
        <footer>
            <p>© 2026 Polar Lights Forum • share the glow</p>
        </footer>
    </div>
</body>
</html>

